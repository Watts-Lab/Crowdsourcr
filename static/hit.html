<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/static/css/main.css" />
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://underscorejs.org/underscore-min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/autoexpand.js"></script>
    <script src="/static/js/mixins.js"></script>
    <script src="/static/js/simplemodels.js"></script>
    <script type="text/javascript">
      $(requestNextTask);
      var MODULES = [];

      function requestNextTask() {
	  $.get('/HIT/view/', function(data) {
	      if (data.reload_for_first_task) {
		  requestNextTask();
	      } else if (data.completed_hit) {
		  alert('done');
	      } else {
		  $('#hit-content').html(data.content);
		  for (var i = 0; i < data.modules.length; i++){
		      getModule(data.modules[i], registerModule);
		  }
	      }
	      $('#next-task-button').click(function(evt) {
		  evt.preventDefault();
		  submitTask(requestNextTask);
	      });
	  });
      }

      function submitTask(callback) {
	  $.post('/HIT/submit/', {data : JSON.stringify(serializeModules())}, callback);
      }

      function serializeModules() {
	  var all_module_responses = [];
	  for (var i = 0; i < MODULES.length; i++) {
	      all_module_responses.push(MODULES[i].serialize());
	  }
	  return all_module_responses;
      }

      function registerModule(data) {
	  $('#hit-modules').empty();
	  var module_container = $(document.createElement('li'));
	  var module = module_container.CType(data);
	  module.renderDisplay();
	  $('#hit-modules').append(module_container);
	  MODULES.push(module);
      }

      function getModule(module, callback) {
	  $.get('/types/view/'+module, callback);
      }
      
    </script>
  </head>
  <body>
    <div class="header-container">
      <div class="header-title abs-center"><h3>News Crowdsourcer v1.0</h3></div>
    </div>
    <div class="header-push"></div>
    <div class="content-main">
      <div id="hit-content" class="splitscreen"></div>
      <div class="splitscreen">
	<ul id="hit-modules"></ul><br>
	<button id="next-task-button" class="btn btn-success">Continue to next task</button>
      </div>
    </div>


    <script type="text/template" id="ctype-display-template">
      <h4 data-prop="header"></h4>
      <form class="form-control">
	<ul class="question-display-container"></ul>
      </form>
    </script>

    <script type="text/template" id="numericquestion-display-template">
      <div class="control-group">
	<label> <%= questiontext %> </label>
	<input type="number" name="<%= varname %>"/>
      </div>
    </script>
    
    <script type="text/template" id="catquestion-display-template">
      <div class="control-group">
	<label> <%= questiontext %> </label>
	<% _.each(content, function(choice) { %> <input type="radio" name="<%= varname %>" value="<%= choice.value %>"> <%= choice.text %> </input> <% }); %>
      </div>
    </script>
    
    

 </body>
</html>
